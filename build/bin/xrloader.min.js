THREE.OrbitControls=function(e,t){var n,a,o,r,i;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),d=h.NONE},this.update=(n=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=a.clone().inverse(),r=new THREE.Vector3,i=new THREE.Quaternion,function(){var e=s.object.position;return n.copy(e).sub(s.target),n.applyQuaternion(a),m.setFromVector3(n),s.autoRotate&&d===h.NONE&&j(2*Math.PI/60/60*s.autoRotateSpeed),m.theta+=E.theta,m.phi+=E.phi,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=f,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),s.target.add(b),n.setFromSpherical(m),n.applyQuaternion(o),e.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(E.theta*=1-s.dampingFactor,E.phi*=1-s.dampingFactor):E.set(0,0,0),f=1,b.set(0,0,0),!!(g||r.distanceToSquared(s.object.position)>p||8*(1-i.dot(s.object.quaternion))>p)&&(s.dispatchEvent(c),r.copy(s.object.position),i.copy(s.object.quaternion),g=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",_,!1),s.domElement.removeEventListener("mousedown",N,!1),s.domElement.removeEventListener("wheel",I,!1),s.domElement.removeEventListener("touchstart",B,!1),s.domElement.removeEventListener("touchend",Y,!1),s.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",z,!1)};var s=this,c={type:"change"},l={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=h.NONE,p=1e-6,m=new THREE.Spherical,E=new THREE.Spherical,f=1,b=new THREE.Vector3,g=!1,v=new THREE.Vector2,y=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,w=new THREE.Vector2,H=new THREE.Vector2,x=new THREE.Vector2,O=new THREE.Vector2,L=new THREE.Vector2;function M(){return Math.pow(.95,s.zoomSpeed)}function j(e){E.theta-=e}function P(e){E.phi-=e}var C,A=(C=new THREE.Vector3,function(e,t){C.setFromMatrixColumn(t,0),C.multiplyScalar(-e),b.add(C)}),k=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),b.add(e)}}(),V=function(){var e=new THREE.Vector3;return function(t,n){var a=s.domElement===document?s.domElement.body:s.domElement;if(s.object instanceof THREE.PerspectiveCamera){var o=s.object.position;e.copy(o).sub(s.target);var r=e.length();r*=Math.tan(s.object.fov/2*Math.PI/180),A(2*t*r/a.clientHeight,s.object.matrix),k(2*n*r/a.clientHeight,s.object.matrix)}else s.object instanceof THREE.OrthographicCamera?(A(t*(s.object.right-s.object.left)/s.object.zoom/a.clientWidth,s.object.matrix),k(n*(s.object.top-s.object.bottom)/s.object.zoom/a.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function F(e){s.object instanceof THREE.PerspectiveCamera?f/=e:s.object instanceof THREE.OrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(e){s.object instanceof THREE.PerspectiveCamera?f*=e:s.object instanceof THREE.OrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(e){v.set(e.clientX,e.clientY)}(e),d=h.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(e){R.set(e.clientX,e.clientY)}(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",S,!1),document.addEventListener("mouseup",U,!1),s.dispatchEvent(l))}}function S(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),T.subVectors(y,v);var t=s.domElement===document?s.domElement.body:s.domElement;j(2*Math.PI*T.x/t.clientWidth*s.rotateSpeed),P(2*Math.PI*T.y/t.clientHeight*s.rotateSpeed),v.copy(y),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){O.set(e.clientX,e.clientY),L.subVectors(O,x),L.y>0?F(M()):L.y<0&&D(M()),x.copy(O),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){w.set(e.clientX,e.clientY),H.subVectors(w,R),V(H.x,H.y),R.copy(w),s.update()}(e)}}function U(e){!1!==s.enabled&&(document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",U,!1),s.dispatchEvent(u),d=h.NONE)}function I(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?D(M()):e.deltaY>0&&F(M()),s.update()}(e),s.dispatchEvent(l),s.dispatchEvent(u))}function z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:V(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:V(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:V(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:V(-s.keyPanSpeed,0),s.update()}}(e)}function B(e){if(!1!==s.enabled){switch(e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){v.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);x.set(0,a)}(e),d=h.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(e){R.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(l)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(e){y.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(y,v);var t=s.domElement===document?s.domElement.body:s.domElement;j(2*Math.PI*T.x/t.clientWidth*s.rotateSpeed),P(2*Math.PI*T.y/t.clientHeight*s.rotateSpeed),v.copy(y),s.update()}(e);break;case 2:if(!1===s.enableZoom)return;if(d!==h.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);O.set(0,a),L.subVectors(O,x),L.y>0?D(M()):L.y<0&&F(M()),x.copy(O),s.update()}(e);break;case 3:if(!1===s.enablePan)return;if(d!==h.TOUCH_PAN)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),H.subVectors(w,R),V(H.x,H.y),R.copy(w),s.update()}(e);break;default:d=h.NONE}}function Y(e){!1!==s.enabled&&(s.dispatchEvent(u),d=h.NONE)}function _(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",_,!1),s.domElement.addEventListener("mousedown",N,!1),s.domElement.addEventListener("wheel",I,!1),s.domElement.addEventListener("touchstart",B,!1),s.domElement.addEventListener("touchend",Y,!1),s.domElement.addEventListener("touchmove",Z,!1),window.addEventListener("keydown",z,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var WEBVR={createButton:function(e,t){function n(t){r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.domElement}])},e.vr.setDevice(t)}function a(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.textContent="VR NOT FOUND",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,e.vr.setDevice(null)}function o(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}var r;if(t&&t.frameOfReferenceType&&e.vr.setFrameOfReferenceType(t.frameOfReferenceType),"xr"in navigator)return(r=document.createElement("button")).style.display="none",o(r),navigator.xr.requestDevice().then(function(t){t.supportsSession({immersive:!0,exclusive:!0}).then(function(){!function(t){var n=null;function a(t){t.addEventListener("end",o),e.vr.setSession(t),r.textContent="EXIT VR",n=t}function o(t){n.removeEventListener("end",o),e.vr.setSession(null),r.textContent="ENTER VR",n=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===n?t.requestSession({immersive:!0,exclusive:!0}).then(a):n.end()},e.vr.setDevice(t)}(t)}).catch(a)}).catch(a),r;if("getVRDisplays"in navigator)return(r=document.createElement("button")).style.display="none",o(r),window.addEventListener("vrdisplayconnect",function(e){n(e.display)},!1),window.addEventListener("vrdisplaydisconnect",function(e){a()},!1),window.addEventListener("vrdisplaypresentchange",function(e){r.textContent=e.display.isPresenting?"EXIT VR":"ENTER VR"},!1),window.addEventListener("vrdisplayactivate",function(t){t.display.requestPresent([{source:e.domElement}])},!1),navigator.getVRDisplays().then(function(e){e.length>0?n(e[0]):a()}).catch(a),r;var i=document.createElement("a");return i.href="https://webvr.info",i.innerHTML="WEBVR NOT SUPPORTED",i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",o(i),i},checkAvailability:function(){return console.warn("WEBVR.checkAvailability has been deprecated."),new Promise(function(){})},getMessageContainer:function(){return console.warn("WEBVR.getMessageContainer has been deprecated."),document.createElement("div")},getButton:function(){return console.warn("WEBVR.getButton has been deprecated."),document.createElement("div")},getVRDisplay:function(){console.warn("WEBVR.getVRDisplay has been deprecated.")}};THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,n,a){var o=this,r=new THREE.FileLoader(this.manager);r.setPath(this.path),r.load(e,function(e){t(o.parse(e))},n,a)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),n={},a=/\s+/,o={},r=0;r<t.length;r++){var i=t[r];if(0!==(i=i.trim()).length&&"#"!==i.charAt(0)){var s=i.indexOf(" "),c=s>=0?i.substring(0,s):i;c=c.toLowerCase();var l=s>=0?i.substring(s+1):"";if(l=l.trim(),"newmtl"===c)n={name:l},o[l]=n;else if(n)if("ka"===c||"kd"===c||"ks"===c){var u=l.split(a,3);n[c]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else n[c]=l}}var h=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(o),h}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var n in e){var a=e[n],o={};for(var r in t[n]=o,a){var i=!0,s=a[r],c=r.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(i=!1)}i&&(o[c]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,n=this.materialsInfo[e],a={name:e,side:this.side};function o(e,n){if(!a[e]){var o,r,i=t.getTextureParams(n,a),s=t.loadTexture((o=t.baseUrl,"string"!=typeof(r=i.url)||""===r?"":/^https?:\/\//i.test(r)?r:o+r));s.repeat.copy(i.scale),s.offset.copy(i.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,a[e]=s}}for(var r in n){var i,s=n[r];if(""!==s)switch(r.toLowerCase()){case"kd":a.color=(new THREE.Color).fromArray(s);break;case"ks":a.specular=(new THREE.Color).fromArray(s);break;case"map_kd":o("map",s);break;case"map_ks":o("specularMap",s);break;case"norm":o("normalMap",s);break;case"map_bump":case"bump":o("bumpMap",s);break;case"ns":a.shininess=parseFloat(s);break;case"d":(i=parseFloat(s))<1&&(a.opacity=i,a.transparent=!0);break;case"tr":(i=parseFloat(s))>0&&(a.opacity=1-i,a.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(a),this.materials[e]},getTextureParams:function(e,t){var n,a={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},o=e.split(/\s+/);return(n=o.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(o[n+1]),o.splice(n,2)),(n=o.indexOf("-s"))>=0&&(a.scale.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),(n=o.indexOf("-o"))>=0&&(a.offset.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),a.url=o.join(" ").trim(),a},loadTexture:function(e,t,n,a,o){var r,i=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===i&&(i=new THREE.TextureLoader(s)),i.setCrossOrigin&&i.setCrossOrigin(this.crossOrigin),r=i.load(e,n,a,o),void 0!==t&&(r.mapping=t),r}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /;function a(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return a.prototype={constructor:a,load:function(e,t,n,a){var o=this,r=new THREE.FileLoader(o.manager);r.setPath(this.path),r.load(e,function(e){t(o.parse(e))},n,a)},setPath:function(e){this.path=e},setMaterials:function(e){return this.materials=e,this},parse:function(a){console.time("OBJLoader");var o=new function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var a=n.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var a=this.vertices,o=this.object.geometry.vertices;o.push(a[e+0],a[e+1],a[e+2]),o.push(a[t+0],a[t+1],a[t+2]),o.push(a[n+0],a[n+1],a[n+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var a=this.normals,o=this.object.geometry.normals;o.push(a[e+0],a[e+1],a[e+2]),o.push(a[t+0],a[t+1],a[t+2]),o.push(a[n+0],a[n+1],a[n+2])},addUV:function(e,t,n){var a=this.uvs,o=this.object.geometry.uvs;o.push(a[e+0],a[e+1]),o.push(a[t+0],a[t+1]),o.push(a[n+0],a[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,a,o,r,i,s,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),d=this.parseVertexIndex(n,l);if(this.addVertex(u,h,d),void 0!==a){var p=this.uvs.length;u=this.parseUVIndex(a,p),h=this.parseUVIndex(o,p),d=this.parseUVIndex(r,p),this.addUV(u,h,d)}if(void 0!==i){var m=this.normals.length;u=this.parseNormalIndex(i,m),h=i===s?u:this.parseNormalIndex(s,m),d=i===c?u:this.parseNormalIndex(c,m),this.addNormal(u,h,d)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,a=this.uvs.length,o=0,r=e.length;o<r;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var i=0;for(r=t.length;i<r;i++)this.addUVLine(this.parseUVIndex(t[i],a))}};return e.startObject("",!1),e};-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var r=a.split("\n"),i="",s="",c=[],l="function"==typeof"".trimLeft,u=0,h=r.length;u<h;u++)if(i=r[u],0!==(i=l?i.trimLeft():i.trim()).length&&"#"!==(s=i.charAt(0)))if("v"===s){var d=i.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===s){for(var p=i.substr(1).trim().split(/\s+/),m=[],E=0,f=p.length;E<f;E++){var b=p[E];if(b.length>0){var g=b.split("/");m.push(g)}}var v=m[0];for(E=1,f=m.length-1;E<f;E++){var y=m[E],T=m[E+1];o.addFace(v[0],y[0],T[0],v[1],y[1],T[1],v[2],y[2],T[2])}}else if("l"===s){var R=i.substring(1).trim().split(" "),w=[],H=[];if(-1===i.indexOf("/"))w=R;else for(var x=0,O=R.length;x<O;x++){var L=R[x].split("/");""!==L[0]&&w.push(L[0]),""!==L[1]&&H.push(L[1])}o.addLineGeometry(w,H)}else if(null!==(c=e.exec(i))){var M=(" "+c[0].substr(1).trim()).substr(1);o.startObject(M)}else if(n.test(i))o.object.startMaterial(i.substring(7).trim(),o.materialLibraries);else if(t.test(i))o.materialLibraries.push(i.substring(7).trim());else{if("s"!==s){if("\0"===i)continue;throw new Error("Unexpected line: '"+i+"'")}if((c=i.split(" ")).length>1){var j=c[1].trim().toLowerCase();o.object.smooth="0"!==j&&"off"!==j}else o.object.smooth=!0;(z=o.object.currentMaterial())&&(z.smooth=o.object.smooth)}o.finalize();var P=new THREE.Group;P.materialLibraries=[].concat(o.materialLibraries);for(u=0,h=o.objects.length;u<h;u++){var C=o.objects[u],A=C.geometry,k=C.materials,V="Line"===A.type;if(0!==A.vertices.length){var F=new THREE.BufferGeometry;F.addAttribute("position",new THREE.BufferAttribute(new Float32Array(A.vertices),3)),A.normals.length>0?F.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(A.normals),3)):F.computeVertexNormals(),A.uvs.length>0&&F.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(A.uvs),2));for(var D,N=[],S=0,U=k.length;S<U;S++){var I=k[S],z=void 0;if(null!==this.materials&&(z=this.materials.create(I.name),V&&z&&!(z instanceof THREE.LineBasicMaterial))){var B=new THREE.LineBasicMaterial;B.copy(z),z=B}z||((z=V?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=I.name),z.flatShading=!I.smooth,N.push(z)}if(N.length>1){for(S=0,U=k.length;S<U;S++){I=k[S];F.addGroup(I.groupStart,I.groupCount,S)}D=V?new THREE.LineSegments(F,N):new THREE.Mesh(F,N)}else D=V?new THREE.LineSegments(F,N[0]):new THREE.Mesh(F,N[0]);D.name=C.name,P.add(D)}}return console.timeEnd("OBJLoader"),P}},a}();class Model extends HTMLElement{constructor(){super()}connectedCallback(){console.log("Custom element added to page."),updateModel(this)}disconnectedCallback(){console.log("Custom element removed from page.")}adoptedCallback(){console.log("Custom element moved to new page.")}attributeChangedCallback(e,t,n){console.log("Custom element attributes changed."),updateModel(this)}static get observedAttributes(){return["c","l"]}getWidth(){return this.style.width.replace(/[a-z]/g,"")}getHeight(){return this.style.height.replace(/[a-z]/g,"")}getObjectPath(){return this.getAttribute("obj")}getMaterialPath(){return this.getAttribute("mtl")}getTexturePath(){return this.getAttribute("texturePath")}getDisplay(){return"true"===this.getAttribute("desktop")?"inherit":"none"}getPosition(){let e=this.getAttribute("position").split(",");return{x:parseFloat(e[0]),y:parseFloat(e[1]),z:parseFloat(e[2])}}getScale(){let e=this.getAttribute("scale").split(",");return{x:parseFloat(e[0]),y:parseFloat(e[1]),z:parseFloat(e[2])}}}function updateModel(e){const t=e.getMaterialPath(),n=e.getObjectPath(),a=e.getTexturePath(),o=e.getDisplay(),r=e.getPosition(),i=e.getScale(),s=new THREE.Scene,c=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);c.position.z=200;const l=new THREE.WebGLRenderer;l.setSize(window.innerWidth,window.innerHeight),l.domElement.style.display=o;let u=WEBVR.createButton(l);u.style.display=o,document.body.appendChild(u),l.vr.enabled=!0,document.body.appendChild(l.domElement);const h=new THREE.OrbitControls(c,l.domElement);h.enableDamping=!0,h.dampingFactor=.25,h.enableZoom=!0;const d=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),1);d.position.set(-100,0,100);const p=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.75);p.position.set(100,0,100);const m=new THREE.DirectionalLight(16777215,1);m.position.set(100,0,-100).normalize(),s.add(d),s.add(p),s.add(m);const E=new THREE.MTLLoader;E.setTexturePath(a),E.setPath(a),E.load(t,function(e){e.preload();const t=new THREE.OBJLoader;t.setMaterials(e),t.setPath(a),t.load(n,function(e){s.add(e),e.position.set(r.x,r.y,r.z),e.scale.set(i.x,i.y,i.z)})});const f=function(){requestAnimationFrame(f),h.update(),l.render(s,c)};f()}customElements.define("xr-mdl",Model);