THREE.OrbitControls=function(e,t){var n,o,a,i,s;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(c),r.update(),d=h.NONE},this.update=(n=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=o.clone().inverse(),i=new THREE.Vector3,s=new THREE.Quaternion,function(){var e=r.object.position;return n.copy(e).sub(r.target),n.applyQuaternion(o),m.setFromVector3(n),r.autoRotate&&d===h.NONE&&P(2*Math.PI/60/60*r.autoRotateSpeed),m.theta+=f.theta,m.phi+=f.phi,m.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,m.theta)),m.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=E,m.radius=Math.max(r.minDistance,Math.min(r.maxDistance,m.radius)),r.target.add(b),n.setFromSpherical(m),n.applyQuaternion(a),e.copy(r.target).add(n),r.object.lookAt(r.target),!0===r.enableDamping?(f.theta*=1-r.dampingFactor,f.phi*=1-r.dampingFactor):f.set(0,0,0),E=1,b.set(0,0,0),!!(g||i.distanceToSquared(r.object.position)>p||8*(1-s.dot(r.object.quaternion))>p)&&(r.dispatchEvent(c),i.copy(r.object.position),s.copy(r.object.quaternion),g=!1,!0)}),this.dispose=function(){r.domElement.removeEventListener("contextmenu",X,!1),r.domElement.removeEventListener("mousedown",N,!1),r.domElement.removeEventListener("wheel",S,!1),r.domElement.removeEventListener("touchstart",B,!1),r.domElement.removeEventListener("touchend",Y,!1),r.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",I,!1),window.removeEventListener("keydown",U,!1)};var r=this,c={type:"change"},l={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=h.NONE,p=1e-6,m=new THREE.Spherical,f=new THREE.Spherical,E=1,b=new THREE.Vector3,g=!1,v=new THREE.Vector2,y=new THREE.Vector2,R=new THREE.Vector2,T=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,H=new THREE.Vector2,O=new THREE.Vector2,L=new THREE.Vector2;function j(){return Math.pow(.95,r.zoomSpeed)}function P(e){f.theta-=e}function M(e){f.phi-=e}var A,C=(A=new THREE.Vector3,function(e,t){A.setFromMatrixColumn(t,0),A.multiplyScalar(-e),b.add(A)}),k=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),b.add(e)}}(),V=function(){var e=new THREE.Vector3;return function(t,n){var o=r.domElement===document?r.domElement.body:r.domElement;if(r.object instanceof THREE.PerspectiveCamera){var a=r.object.position;e.copy(a).sub(r.target);var i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),C(2*t*i/o.clientHeight,r.object.matrix),k(2*n*i/o.clientHeight,r.object.matrix)}else r.object instanceof THREE.OrthographicCamera?(C(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),k(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function F(e){r.object instanceof THREE.PerspectiveCamera?E/=e:r.object instanceof THREE.OrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function D(e){r.object instanceof THREE.PerspectiveCamera?E*=e:r.object instanceof THREE.OrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function N(e){if(!1!==r.enabled){switch(e.preventDefault(),e.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(e){v.set(e.clientX,e.clientY)}(e),d=h.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(e){H.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(e){T.set(e.clientX,e.clientY)}(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",I,!1),r.dispatchEvent(l))}}function z(e){if(!1!==r.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===r.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),R.subVectors(y,v);var t=r.domElement===document?r.domElement.body:r.domElement;P(2*Math.PI*R.x/t.clientWidth*r.rotateSpeed),M(2*Math.PI*R.y/t.clientHeight*r.rotateSpeed),v.copy(y),r.update()}(e);break;case h.DOLLY:if(!1===r.enableZoom)return;!function(e){O.set(e.clientX,e.clientY),L.subVectors(O,H),L.y>0?F(j()):L.y<0&&D(j()),H.copy(O),r.update()}(e);break;case h.PAN:if(!1===r.enablePan)return;!function(e){w.set(e.clientX,e.clientY),x.subVectors(w,T),V(x.x,x.y),T.copy(w),r.update()}(e)}}function I(e){!1!==r.enabled&&(document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",I,!1),r.dispatchEvent(u),d=h.NONE)}function S(e){!1===r.enabled||!1===r.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?D(j()):e.deltaY>0&&F(j()),r.update()}(e),r.dispatchEvent(l),r.dispatchEvent(u))}function U(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){switch(e.keyCode){case r.keys.UP:V(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:V(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:V(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:V(-r.keyPanSpeed,0),r.update()}}(e)}function B(e){if(!1!==r.enabled){switch(e.touches.length){case 1:if(!1===r.enableRotate)return;!function(e){v.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===r.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);H.set(0,o)}(e),d=h.TOUCH_DOLLY;break;case 3:if(!1===r.enablePan)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_PAN;break;default:d=h.NONE}d!==h.NONE&&r.dispatchEvent(l)}}function Z(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(e){y.set(e.touches[0].pageX,e.touches[0].pageY),R.subVectors(y,v);var t=r.domElement===document?r.domElement.body:r.domElement;P(2*Math.PI*R.x/t.clientWidth*r.rotateSpeed),M(2*Math.PI*R.y/t.clientHeight*r.rotateSpeed),v.copy(y),r.update()}(e);break;case 2:if(!1===r.enableZoom)return;if(d!==h.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);O.set(0,o),L.subVectors(O,H),L.y>0?D(j()):L.y<0&&F(j()),H.copy(O),r.update()}(e);break;case 3:if(!1===r.enablePan)return;if(d!==h.TOUCH_PAN)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(w,T),V(x.x,x.y),T.copy(w),r.update()}(e);break;default:d=h.NONE}}function Y(e){!1!==r.enabled&&(r.dispatchEvent(u),d=h.NONE)}function X(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",X,!1),r.domElement.addEventListener("mousedown",N,!1),r.domElement.addEventListener("wheel",S,!1),r.domElement.addEventListener("touchstart",B,!1),r.domElement.addEventListener("touchend",Y,!1),r.domElement.addEventListener("touchmove",Z,!1),window.addEventListener("keydown",U,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var WEBVR={createButton:function(e,t){function n(t){i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.domElement}])},e.vr.setDevice(t)}function o(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.textContent="VR NOT FOUND",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,e.vr.setDevice(null)}function a(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}var i;if(t&&t.frameOfReferenceType&&e.vr.setFrameOfReferenceType(t.frameOfReferenceType),"xr"in navigator)return(i=document.createElement("button")).style.display="none",a(i),navigator.xr.requestDevice().then(function(t){t.supportsSession({immersive:!0,exclusive:!0}).then(function(){!function(t){var n=null;function o(t){t.addEventListener("end",a),e.vr.setSession(t),i.textContent="EXIT VR",n=t}function a(t){n.removeEventListener("end",a),e.vr.setSession(null),i.textContent="ENTER VR",n=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===n?t.requestSession({immersive:!0,exclusive:!0}).then(o):n.end()},e.vr.setDevice(t)}(t)}).catch(o)}).catch(o),i;if("getVRDisplays"in navigator)return(i=document.createElement("button")).style.display="none",a(i),window.addEventListener("vrdisplayconnect",function(e){n(e.display)},!1),window.addEventListener("vrdisplaydisconnect",function(e){o()},!1),window.addEventListener("vrdisplaypresentchange",function(e){i.textContent=e.display.isPresenting?"EXIT VR":"ENTER VR"},!1),window.addEventListener("vrdisplayactivate",function(t){t.display.requestPresent([{source:e.domElement}])},!1),navigator.getVRDisplays().then(function(e){e.length>0?n(e[0]):o()}).catch(o),i;var s=document.createElement("a");return s.href="https://webvr.info",s.innerHTML="WEBVR NOT SUPPORTED",s.style.left="calc(50% - 90px)",s.style.width="180px",s.style.textDecoration="none",a(s),s},checkAvailability:function(){return console.warn("WEBVR.checkAvailability has been deprecated."),new Promise(function(){})},getMessageContainer:function(){return console.warn("WEBVR.getMessageContainer has been deprecated."),document.createElement("div")},getButton:function(){return console.warn("WEBVR.getButton has been deprecated."),document.createElement("div")},getVRDisplay:function(){console.warn("WEBVR.getVRDisplay has been deprecated.")}};let scene;THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,n,o){var a=this,i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.load(e,function(e){t(a.parse(e))},n,o)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),n={},o=/\s+/,a={},i=0;i<t.length;i++){var s=t[i];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var r=s.indexOf(" "),c=r>=0?s.substring(0,r):s;c=c.toLowerCase();var l=r>=0?s.substring(r+1):"";if(l=l.trim(),"newmtl"===c)n={name:l},a[l]=n;else if(n)if("ka"===c||"kd"===c||"ks"===c){var u=l.split(o,3);n[c]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else n[c]=l}}var h=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(a),h}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var n in e){var o=e[n],a={};for(var i in t[n]=a,o){var s=!0,r=o[i],c=i.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(s=!1)}s&&(a[c]=r)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,n=this.materialsInfo[e],o={name:e,side:this.side};function a(e,n){if(!o[e]){var a,i,s=t.getTextureParams(n,o),r=t.loadTexture((a=t.baseUrl,"string"!=typeof(i=s.url)||""===i?"":/^https?:\/\//i.test(i)?i:a+i));r.repeat.copy(s.scale),r.offset.copy(s.offset),r.wrapS=t.wrap,r.wrapT=t.wrap,o[e]=r}}for(var i in n){var s,r=n[i];if(""!==r)switch(i.toLowerCase()){case"kd":o.color=(new THREE.Color).fromArray(r);break;case"ks":o.specular=(new THREE.Color).fromArray(r);break;case"map_kd":a("map",r);break;case"map_ks":a("specularMap",r);break;case"norm":a("normalMap",r);break;case"map_bump":case"bump":a("bumpMap",r);break;case"ns":o.shininess=parseFloat(r);break;case"d":(s=parseFloat(r))<1&&(o.opacity=s,o.transparent=!0);break;case"tr":(s=parseFloat(r))>0&&(o.opacity=1-s,o.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(o),this.materials[e]},getTextureParams:function(e,t){var n,o={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},a=e.split(/\s+/);return(n=a.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(a[n+1]),a.splice(n,2)),(n=a.indexOf("-s"))>=0&&(o.scale.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),(n=a.indexOf("-o"))>=0&&(o.offset.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),o.url=a.join(" ").trim(),o},loadTexture:function(e,t,n,o,a){var i,s=THREE.Loader.Handlers.get(e),r=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===s&&(s=new THREE.TextureLoader(r)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),i=s.load(e,n,o,a),void 0!==t&&(i.mapping=t),i}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /;function o(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return o.prototype={constructor:o,load:function(e,t,n,o){var a=this,i=new THREE.FileLoader(a.manager);i.setPath(this.path),i.load(e,function(e){t(a.parse(e))},n,o)},setPath:function(e){this.path=e},setMaterials:function(e){return this.materials=e,this},parse:function(o){console.time("OBJLoader");var a=new function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var o={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var o=n.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var o=this.vertices,a=this.object.geometry.vertices;a.push(o[e+0],o[e+1],o[e+2]),a.push(o[t+0],o[t+1],o[t+2]),a.push(o[n+0],o[n+1],o[n+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var o=this.normals,a=this.object.geometry.normals;a.push(o[e+0],o[e+1],o[e+2]),a.push(o[t+0],o[t+1],o[t+2]),a.push(o[n+0],o[n+1],o[n+2])},addUV:function(e,t,n){var o=this.uvs,a=this.object.geometry.uvs;a.push(o[e+0],o[e+1]),a.push(o[t+0],o[t+1]),a.push(o[n+0],o[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,o,a,i,s,r,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),d=this.parseVertexIndex(n,l);if(this.addVertex(u,h,d),void 0!==o){var p=this.uvs.length;u=this.parseUVIndex(o,p),h=this.parseUVIndex(a,p),d=this.parseUVIndex(i,p),this.addUV(u,h,d)}if(void 0!==s){var m=this.normals.length;u=this.parseNormalIndex(s,m),h=s===r?u:this.parseNormalIndex(r,m),d=s===c?u:this.parseNormalIndex(c,m),this.addNormal(u,h,d)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,o=this.uvs.length,a=0,i=e.length;a<i;a++)this.addVertexLine(this.parseVertexIndex(e[a],n));var s=0;for(i=t.length;s<i;s++)this.addUVLine(this.parseUVIndex(t[s],o))}};return e.startObject("",!1),e};-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var i=o.split("\n"),s="",r="",c=[],l="function"==typeof"".trimLeft,u=0,h=i.length;u<h;u++)if(s=i[u],0!==(s=l?s.trimLeft():s.trim()).length&&"#"!==(r=s.charAt(0)))if("v"===r){var d=s.split(/\s+/);switch(d[0]){case"v":a.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vn":a.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":a.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===r){for(var p=s.substr(1).trim().split(/\s+/),m=[],f=0,E=p.length;f<E;f++){var b=p[f];if(b.length>0){var g=b.split("/");m.push(g)}}var v=m[0];for(f=1,E=m.length-1;f<E;f++){var y=m[f],R=m[f+1];a.addFace(v[0],y[0],R[0],v[1],y[1],R[1],v[2],y[2],R[2])}}else if("l"===r){var T=s.substring(1).trim().split(" "),w=[],x=[];if(-1===s.indexOf("/"))w=T;else for(var H=0,O=T.length;H<O;H++){var L=T[H].split("/");""!==L[0]&&w.push(L[0]),""!==L[1]&&x.push(L[1])}a.addLineGeometry(w,x)}else if(null!==(c=e.exec(s))){var j=(" "+c[0].substr(1).trim()).substr(1);a.startObject(j)}else if(n.test(s))a.object.startMaterial(s.substring(7).trim(),a.materialLibraries);else if(t.test(s))a.materialLibraries.push(s.substring(7).trim());else{if("s"!==r){if("\0"===s)continue;throw new Error("Unexpected line: '"+s+"'")}if((c=s.split(" ")).length>1){var P=c[1].trim().toLowerCase();a.object.smooth="0"!==P&&"off"!==P}else a.object.smooth=!0;(U=a.object.currentMaterial())&&(U.smooth=a.object.smooth)}a.finalize();var M=new THREE.Group;M.materialLibraries=[].concat(a.materialLibraries);for(u=0,h=a.objects.length;u<h;u++){var A=a.objects[u],C=A.geometry,k=A.materials,V="Line"===C.type;if(0!==C.vertices.length){var F=new THREE.BufferGeometry;F.addAttribute("position",new THREE.BufferAttribute(new Float32Array(C.vertices),3)),C.normals.length>0?F.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(C.normals),3)):F.computeVertexNormals(),C.uvs.length>0&&F.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(C.uvs),2));for(var D,N=[],z=0,I=k.length;z<I;z++){var S=k[z],U=void 0;if(null!==this.materials&&(U=this.materials.create(S.name),V&&U&&!(U instanceof THREE.LineBasicMaterial))){var B=new THREE.LineBasicMaterial;B.copy(U),U=B}U||((U=V?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=S.name),U.flatShading=!S.smooth,N.push(U)}if(N.length>1){for(z=0,I=k.length;z<I;z++){S=k[z];F.addGroup(S.groupStart,S.groupCount,z)}D=V?new THREE.LineSegments(F,N):new THREE.Mesh(F,N)}else D=V?new THREE.LineSegments(F,N[0]):new THREE.Mesh(F,N[0]);D.name=A.name,M.add(D)}}return console.timeEnd("OBJLoader"),M}},o}();const XRLoader={initialized:!1,init:e=>{scene=new THREE.Scene;let t=e.desktop;const n=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);n.position.z=200,navigator.getARDisplay().then(e=>{console.log(e);const o=new THREE.WebGLRenderer({alpha:!1,canvas:e.canvas});let a=WEBVR.createButton(o);a.style.display=t,document.body.appendChild(a),o.vr.enabled=!0;const i=new THREE.OrbitControls(n,o.domElement);i.enableDamping=!0,i.dampingFactor=.25,i.enableZoom=!0;const s=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),1);s.position.set(-100,0,100);const r=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.75);r.position.set(100,0,100);const c=new THREE.DirectionalLight(16777215,1);c.position.set(100,0,-100).normalize(),scene.add(s),scene.add(r),scene.add(c);const l=function(){requestAnimationFrame(l),i.update(),o.render(scene,n),document.querySelectorAll("xr-mdl").forEach(e=>{const t=e.getPosition(),n=e.getScale(),o=e.getRotation();e.object&&(e.object.position.set(t.x,t.y,t.z),e.object.scale.set(n.x,n.y,n.z),e.object.rotation.set(o.x,o.y,o.z))})};l()})}};class XRModel extends HTMLElement{constructor(e){super(),e&&(this.obj=e.obj,this.mtl=e.mtl,this.texturePath=e.texturePath,this.scale=e.scale||"1,1,1",this.offset=e.offset||"0,0,0,",this.rotation=e.rotation||"0,0,0,",this.desktop=e.desktop||!1)}build(){console.log("building!"),this.setAttribute("obj",this.obj),this.setAttribute("mtl",this.mtl),this.setAttribute("texturePath",this.texturePath),this.setAttribute("scale",this.scale),this.setAttribute("offset",this.offset),this.setAttribute("rotation",this.rotation),this.setAttribute("desktop",this.desktop),document.body.appendChild(this)}setObject(e){this.obj=e,this.setAttribute("obj",this.obj)}setMaterial(e){this.mtl=e,this.setAttribute("mtl",this.mtl)}setTexturePath(e){this.texturePath=e,this.setAttribute("texturePath",this.texturePath),this.setAttribute("offset",this.offset)}setScale(e,t,n){this.scale=e+","+t+","+n,this.setAttribute("scale",this.scale)}setOffset(e,t,n){this.offset=e+","+t+","+n,this.setAttribute("offset",this.offset)}setRotation(e,t,n){this.rotation=e+","+t+","+n,this.setAttribute("rotation",this.rotation)}setDesktop(e){this.desktop=e,this.setAttribute("desktop",this.desktop)}setElementId(e){this.appendElementId=e}connectedCallback(){console.log("Custom element added to page."),XRLoader.initialized||XRLoader.init({desktop:this.getDisplay(),id:this.getAttribute("id")}),updateModel(this)}disconnectedCallback(){console.log("Custom element removed from page.")}adoptedCallback(){console.log("Custom element moved to new page.")}attributeChangedCallback(e,t,n){console.log("Custom element attributes changed."),updateModel(this)}static get observedAttributes(){return["c","l"]}getWidth(){return this.style.width.replace(/[a-z]/g,"")}getHeight(){return this.style.height.replace(/[a-z]/g,"")}getObjectPath(){return this.getAttribute("obj")}getMaterialPath(){return this.getAttribute("mtl")}getTexturePath(){return this.getAttribute("texturePath")}getDisplay(){return"true"===this.getAttribute("desktop")?"inherit":"none"}getPosition(){let e=this.getBoundingClientRect(),t=this.getAttribute("offset").split(",");if(window.navigator&&window.navigator.xrlocation){let n=window.navigator.xrlocation;const o=new THREE.Quaternion(n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w),a=new THREE.Vector3((e.x+parseFloat(t[0]))*n.scale,(e.y+parseFloat(t[1]))*n.scale,parseFloat(t[2])*n.scale);a.applyQuaternion(o),t=a.add(new THREE.Vector3(n.position.x,n.position.y,n.position.z)).toArray()}return{x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}}getScale(){let e=this.getAttribute("scale").split(","),t=window.navigator&&window.navigator.xrlocation?window.navigator.xrlocation.scale:1;return{x:parseFloat(e[0])*t,y:parseFloat(e[1])*t,z:parseFloat(e[2])*t}}getRotation(){let e=this.getAttribute("rotation").split(",");return{x:parseFloat(e[0])*(Math.PI/180),y:parseFloat(e[1])*(Math.PI/180),z:parseFloat(e[2])*(Math.PI/180)}}}function updateModel(e){const t=e.getMaterialPath(),n=e.getObjectPath(),o=e.getTexturePath(),a=e.getPosition(),i=e.getScale(),s=e.getRotation(),r=new THREE.MTLLoader;r.setTexturePath(o),r.setPath(o),r.load(t,function(t){t.preload();const r=new THREE.OBJLoader;r.setMaterials(t),r.setPath(o),r.load(n,function(t){scene.add(t),e.object=t,t.position.set(a.x,a.y,a.z),t.scale.set(i.x,i.y,i.z),t.rotation.set(s.x,s.y,s.z)})})}customElements.define("xr-mdl",XRModel);